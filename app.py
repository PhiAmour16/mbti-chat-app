# -*- coding: utf-8 -*-
"""app

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1rej2Qc392cgMK6G5IePr47Yzt4cULkTy
"""

import streamlit as st
import openai

st.set_page_config(page_title="MBTI èŠå¤©åˆ†æå™¨", page_icon="ğŸ§ ")

# è®€å– OpenAI API é‡‘é‘°ï¼ˆéƒ¨ç½²æ™‚å»ºè­°ç”¨ secretsï¼‰
openai.api_key = st.secrets["OPENAI_API_KEY"]

st.title("ğŸ§  MBTI èŠå¤©åˆ†æå™¨")
st.markdown("å’Œæˆ‘èŠèŠï¼Œæˆ‘å°‡æ ¹æ“šä½ çš„å›ç­”é æ¸¬ä½ çš„ MBTI é¡å‹ï¼")

# åˆå§‹åŒ–å°è©±
if "messages" not in st.session_state:
    st.session_state.messages = [
        {"role": "system", "content": "ä½ æ˜¯ä¸€ä½æ“…é•·äººæ ¼åˆ¤æ–·çš„å¿ƒç†å¸«ï¼Œæœƒæ ¹æ“šä½¿ç”¨è€…çš„å›ç­”é€æ­¥é æ¸¬å…¶ MBTI é¡å‹ã€‚è«‹ä»¥è‡ªç„¶èŠå¤©æ–¹å¼äº’å‹•ï¼Œé¿å…ç›´æ¥çµ¦å‡ºçµæœã€‚"}
    ]

# é¡¯ç¤ºæ­·å²èŠå¤©ç´€éŒ„
for msg in st.session_state.messages[1:]:
    st.chat_message(msg["role"]).write(msg["content"])

# ä½¿ç”¨è€…è¼¸å…¥
if user_input := st.chat_input("è¼¸å…¥è¨Šæ¯é–‹å§‹èŠå¤©..."):
    st.chat_message("user").write(user_input)
    st.session_state.messages.append({"role": "user", "content": user_input})

    # å‘¼å« GPT API
    response = openai.ChatCompletion.create(
        model="gpt-4",
        messages=st.session_state.messages
    )

    reply = response.choices[0].message.content
    st.chat_message("assistant").write(reply)
    st.session_state.messages.append({"role": "assistant", "content": reply})